<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ç°¡æ˜“å°éŠæˆ² â€” é»æ“Šé€²å…¥</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#60a5fa;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",sans-serif}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071026 0%, #02111a 100%);color:#e6eef8}
    .center{display:grid;place-items:center;height:100vh;padding:20px}
    .card{width:100%;max-width:920px;background:rgba(255,255,255,0.02);border-radius:12px;padding:22px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}

    /* æ­¡è¿é  */
    .welcome{display:flex;flex-direction:column;gap:18px;align-items:center;justify-content:center;text-align:center;padding:36px}
    .welcome h1{font-size:34px;margin:0}
    .enter-btn{background:linear-gradient(90deg,var(--accent),#7dd3fc);border:none;padding:18px 28px;border-radius:12px;font-size:20px;cursor:pointer;color:#02203a;box-shadow:0 8px 20px rgba(96,165,250,0.12);transition:transform .12s ease}
    .enter-btn:active{transform:scale(.98)}
    .hint{opacity:.8;font-size:14px}

    /* éŠæˆ²ç•«é¢ */
    .game-area{display:none;flex-direction:column;gap:12px}
    .topbar{display:flex;justify-content:space-between;align-items:center}
    .controls{display:flex;gap:10px;align-items:center}
    .btn-small{background:var(--glass);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:10px;color:#cfe8ff}

    /* ç•«å¸ƒèˆ‡æ“ä½œ */
    .canvas-wrap{background:linear-gradient(180deg,#07202a 0%, #031016 100%);border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,0.03)}
    canvas{display:block;background:linear-gradient(180deg,#0b2230, #051927);border-radius:6px;max-width:100%;width:100%;height:420px}

    .mobile-controls{display:flex;gap:12px;justify-content:center;margin-top:10px}
    .control-btn{padding:14px 18px;border-radius:999px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.03);cursor:pointer;user-select:none}

    /* å‹åˆ©é®ç½© */
    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(1,6,12,0.6),rgba(0,0,0,0.6));backdrop-filter:blur(4px);z-index:40}
    .overlay .message{background:linear-gradient(90deg,#fde68a,#fca5a5);padding:30px;border-radius:12px;color:#071422;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.5);max-width:880px;margin:10px}
    .overlay h2{font-size:28px;margin:0 0 10px}
    .overlay p{font-size:20px;margin:8px 0 16px}
    .overlay .ok{padding:12px 18px;border-radius:8px;border:none;cursor:pointer;background:#0b1220;color:#e6eef8}

    /* footer small */
    .small{font-size:13px;opacity:.75}

    @media (max-width:640px){canvas{height:320px}}
  </style>
</head>
<body>
  <div class="center">
    <div class="card">

      <!-- æ­¡è¿é é¢ -->
      <div id="welcome" class="welcome">
        <h1>æ­¡è¿</h1>
        <button id="enterBtn" class="enter-btn">é»æ“Šé€²å…¥</button>
        <div class="hint">é»æ“ŠæŒ‰éˆ•é€²å…¥å°éŠæˆ²ï¼šå‘å‰ç¢°åˆ°ç´…è‰²è˜‹æœå³å¯ç²å‹ï¼å¯ç”¨ â† â†’ éµæˆ–ç•«é¢æŒ‰éˆ•æ§åˆ¶ã€‚</div>
      </div>

      <!-- éŠæˆ²é é¢ -->
      <div id="game" class="game-area">
        <div class="topbar">
          <div class="small">ç°¡æ˜“å°éŠæˆ²</div>
          <div class="controls">
            <button id="restart" class="btn-small">é‡æ–°é–‹å§‹</button>
            <div class="small">æŒ‰éµï¼šâ† â†’ æˆ–ä¸‹æ–¹æŒ‰éˆ•</div>
          </div>
        </div>

        <div class="canvas-wrap">
          <canvas id="gameCanvas" width="860" height="420"></canvas>
        </div>

        <div class="mobile-controls" id="mobileCtrls">
          <div class="control-btn" id="leftBtn">â—€ å‘å¾Œ</div>
          <div class="control-btn" id="rightBtn">å‘å‰ â–¶</div>
        </div>

        <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
          <div class="small">å°æç¤ºï¼šè©¦è‘—æŒ‰ä½æŒ‰éµæˆ–é•·æŒ‰ç•«é¢æŒ‰éˆ•æœƒè®“è§’è‰²é€£çºŒç§»å‹•ã€‚</div>
          <div class="small">è£½ä½œï¼šChatGPT å°éŠæˆ²ç¤ºä¾‹</div>
        </div>

      </div>
    </div>
  </div>

  <!-- å‹åˆ©é®ç½© -->
  <div id="overlay" class="overlay">
    <div class="message">
      <h2>æ­å–œï¼ä½ è´äº† ğŸ‰</h2>
      <p>å†¬ç‡å¤§è€è·‘åœ–çš„æ™‚å€™ï¼Œè¨˜å¾—å¸¶æˆ‘ï¼Œè¬è¬ï¼</p>
      <button id="okBtn" class="ok">å†ç©ä¸€æ¬¡</button>
    </div>
  </div>

  <script>
    // --- åŸºæœ¬å…ƒç´  ---
    const welcome = document.getElementById('welcome');
    const enterBtn = document.getElementById('enterBtn');
    const gameArea = document.getElementById('game');
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const overlay = document.getElementById('overlay');
    const okBtn = document.getElementById('okBtn');
    const restartBtn = document.getElementById('restart');

    // --- éŠæˆ²ç‰©ä»¶ ---
    const player = { x:80, y:300, w:40, h:60, speed:3, vx:0 };
    const apple = { x:720, y:310, r:18 };
    let running = false;
    let won = false;

    // åˆå§‹åŒ–ç•«é¢å¤§å° (å¯éŸ¿æ‡‰)
    function fitCanvas(){
      // keep canvas internal resolution fixed but scale with css width
      const wrapperWidth = Math.min(860, Math.max(320, window.innerWidth - 80));
      canvas.style.width = wrapperWidth + 'px';
    }
    window.addEventListener('resize', fitCanvas);
    fitCanvas();

    // --- ç•«é¢åˆ‡æ› ---
    enterBtn.addEventListener('click', ()=>{
      welcome.style.display = 'none';
      gameArea.style.display = 'flex';
      startGame();
    });

    restartBtn.addEventListener('click', ()=>{ resetGame(); startGame(); });
    okBtn.addEventListener('click', ()=>{ overlay.style.display='none'; resetGame(); startGame(); });

    // --- æ§åˆ¶(éµç›¤ & æ‰‹æ©ŸæŒ‰éˆ•) ---
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    let leftDown=false, rightDown=false;
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowLeft' || e.key === 'Left') leftDown = true;
      if(e.key === 'ArrowRight' || e.key === 'Right') rightDown = true;
    });
    document.addEventListener('keyup', (e)=>{
      if(e.key === 'ArrowLeft' || e.key === 'Left') leftDown = false;
      if(e.key === 'ArrowRight' || e.key === 'Right') rightDown = false;
    });

    // touch / mouse for mobile buttons
    function bindButtonHold(el, setTrue, setFalse){
      el.addEventListener('pointerdown',(e)=>{e.preventDefault(); setTrue();});
      el.addEventListener('pointerup',(e)=>{e.preventDefault(); setFalse();});
      el.addEventListener('pointerleave',(e)=>{e.preventDefault(); setFalse();});
      el.addEventListener('pointercancel',(e)=>{e.preventDefault(); setFalse();});
      // allow long press (touch)
      el.addEventListener('touchstart',(e)=>e.preventDefault(),{passive:false});
    }
    bindButtonHold(leftBtn, ()=>leftDown=true, ()=>leftDown=false);
    bindButtonHold(rightBtn, ()=>rightDown=true, ()=>rightDown=false);

    // --- éŠæˆ²é‚è¼¯ ---
    function resetGame(){
      player.x = 80; player.vx = 0; won = false; running = false;
      apple.x = 720; // å¦‚æœæƒ³è¦æ¯æ¬¡éš¨æ©Ÿå¯æ”¹æˆ Math.random()
      overlay.style.display = 'none';
      drawScene();
    }

    function startGame(){
      if(running) return; running = true; lastTime = performance.now(); loop(lastTime);
    }

    // åŸºæœ¬ç¢°æ’æª¢æŸ¥ (çŸ©å½¢ vs åœ“)
    function rectCircleCollide(rx, ry, rw, rh, cx, cy, cr){
      // æ‰¾åˆ°æœ€è¿‘é»
      const nearestX = Math.max(rx, Math.min(cx, rx+rw));
      const nearestY = Math.max(ry, Math.min(cy, ry+rh));
      const dx = cx - nearestX; const dy = cy - nearestY;
      return (dx*dx + dy*dy) <= cr*cr;
    }

    // ç¹ªè£½å ´æ™¯
    function drawScene(){
      // æ¸…ç©º
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // åœ°æ¿
      ctx.fillStyle = '#05222b';
      ctx.fillRect(0,370,canvas.width,50);

      // é æ™¯ (ç°¡å–®)
      for(let i=0;i<6;i++){
        ctx.fillStyle = `rgba(255,255,255,${0.02 + i*0.01})`;
        ctx.fillRect(40 + i*140, 60 + (i%2)*20, 60, 8);
      }

      // è˜‹æœ (ç´…è‰²åœ“)
      // çµ¦å®ƒä¸€é»äº®å…‰
      ctx.beginPath(); ctx.fillStyle='#e11d48'; ctx.arc(apple.x, apple.y, apple.r, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.fillStyle='rgba(255,255,255,0.18)'; ctx.arc(apple.x-6, apple.y-8, apple.r*0.35, 0, Math.PI*2); ctx.fill();
      // è‘‰å­
      ctx.beginPath(); ctx.fillStyle='#166534'; ctx.ellipse(apple.x+8, apple.y-12, 8, 5, -0.6, 0, Math.PI*2); ctx.fill();

      // ç©å®¶ (å°äººï¼Œç”¨ä¸€å€‹åœ“é ­èˆ‡çŸ©å½¢èº«é«”)
      // shadow
      ctx.fillStyle = 'rgba(2,6,12,0.6)'; ctx.fillRect(player.x+6, player.y + player.h - 4, player.w-8, 6);

      // èº«é«”
      ctx.fillStyle = '#60a5fa'; ctx.fillRect(player.x, player.y, player.w, player.h);
      // é ­
      ctx.beginPath(); ctx.fillStyle='#a7f3d0'; ctx.arc(player.x + player.w/2, player.y - 6, 14, 0, Math.PI*2); ctx.fill();
      // çœ¼ç›
      ctx.fillStyle='#07203a'; ctx.fillRect(player.x + 18, player.y - 10, 4,4);
      ctx.fillRect(player.x + 10, player.y - 10, 4,4);

      // å°æç¤ºçš„ç®­é ­æˆ–ç›®æ¨™æ¨™è¨˜
      ctx.fillStyle = 'rgba(255,255,255,0.06)'; ctx.fillRect(apple.x - 36, apple.y + 26, 72, 6);

      // é‚Šæ¡†
      ctx.strokeStyle = 'rgba(255,255,255,0.03)'; ctx.strokeRect(0,0,canvas.width,canvas.height);
    }

    // ä¸»å›åœˆ
    let lastTime = 0;
    function loop(now){
      if(!running) return; const dt = (now - lastTime) / 16.666; lastTime = now;

      // è™•ç†è¼¸å…¥
      const moveSpeed = player.speed * dt;
      if(leftDown && !rightDown) player.vx = -moveSpeed;
      else if(rightDown && !leftDown) player.vx = moveSpeed;
      else player.vx = 0;

      // æ›´æ–°ä½ç½®
      player.x += player.vx;
      // é™åˆ¶é‚Šç•Œ
      player.x = Math.max(6, Math.min(canvas.width - player.w - 6, player.x));

      // ç¢°æ’åˆ¤å®š
      if(rectCircleCollide(player.x, player.y, player.w, player.h, apple.x, apple.y, apple.r) && !won){
        won = true; running = false; showVictory();
      }

      // ç•«é¢
      drawScene();

      if(!won) requestAnimationFrame(loop);
    }

    function showVictory(){
      overlay.style.display = 'flex';
      // å¯ä»¥åœ¨é€™è£¡åŠ å…¥æ›´å¤šäº’å‹•ï¼ˆä¾‹å¦‚æ’­æ”¾è²æ•ˆï¼‰
    }

    // é¦–æ¬¡ç•«é¢
    resetGame();

    // å…è¨±ä½¿ç”¨è€…ä¸€é–‹å§‹å°±æŒ‰éµè·³é€²
    document.addEventListener('keydown', (e)=>{
      if(welcome.style.display !== 'none' && (e.key === 'Enter' || e.key === ' ')){
        enterBtn.click();
      }
    });

    // åœ¨ç•«å¸ƒä¸Šä¹Ÿæ¥æ”¶é»æ“Šä»¥å¾®ç§»ï¼ˆå¢åŠ äº’å‹•ï¼‰
    canvas.addEventListener('click',(e)=>{
      const rect = canvas.getBoundingClientRect();
      const clickX = (e.clientX - rect.left) * (canvas.width / rect.width);
      // é»æ“Šå³åŠéƒ¨å‘å‰ï¼Œå·¦åŠéƒ¨å‘å¾Œ
      if(clickX > canvas.width/2) { rightDown = true; setTimeout(()=>rightDown=false, 140); }
      else { leftDown = true; setTimeout(()=>leftDown=false, 140); }
    });

  </script>
</body>
</html>
